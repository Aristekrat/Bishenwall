/*! DonateWare 20-11-2013 */
var express=require("express"),routes=require("./routes"),app=express(),jade=require("jade"),mongodb=require("mongodb"),mongoose=require("mongoose"),expressValidator=require("express-validator"),nodeInspector=require("node-inspector"),commentModel=require("./public/schemas/comments.js"),mongo=require("./config/mongo_config.js"),port=process.env.PORT||3e3;app.configure(function(){app.set("views",__dirname+"/views"),app.set("view engine","jade"),app.use(express.bodyParser()),app.use(expressValidator()),app.use(express.methodOverride()),app.use(app.router),app.use(express.static(__dirname+"/public"))}),app.configure("development",function(){app.use(express.errorHandler({dumpExceptions:!0,showStack:!0}))}),app.configure("production",function(){app.use(express.errorHandler())}),app.get("/",routes.index),app.post("/",function(a,b){var c=new commentModel({title:a.body.comment.title,name:a.body.comment.name,text:a.body.comment.text});a.checkBody("comment.title","Title required","comment.text","Comment required").notEmpty(),a.sanitize("comment").xss(),c.save(function(a){a?(console.log(a),b.redirect("/")):(console.log("Good show!"),b.redirect("/"))})}),app.listen(port,function(){console.log("Express server listening on port 3000")});